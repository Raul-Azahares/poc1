# PDF Medical Report Format

## Overview

The PDF medical report generator now follows the format specified in `POC_AI_Record_Template.docx`, creating comprehensive, professionally formatted medical pre-consultation records based on all the information collected during the 27-question interview.

## Report Structure

The generated PDF includes 8 main sections:

### 1. General Patient Information
- **Full Name**: Patient's complete name
- **Age**: Patient's age in years
- **Biological Sex**: Biological sex
- **City / Country**: Current location
- **Weight & Height**: Approximate measurements
- **BMI**: Automatically calculated Body Mass Index

### 2. Reason for Consultation
- **Main Complaint**: Primary symptoms or reason for consultation
- **Symptom Onset**: Duration or when symptoms started
- **Progression**: Whether symptoms are improving/worsening/stable
- **Discomfort Description**: Details about intensity, frequency, triggers
- **Related Symptoms**: Any other associated symptoms

### 3. Medical History
- **Chronic Illnesses or Conditions**: Any diagnosed conditions
- **Current Medications**: Medications being taken (with dosage/frequency)
- **Previous Surgeries**: Major surgical history
- **Known Allergies**: Allergies to medications, foods, etc.
- **Pregnancy**: (If applicable for female patients)

### 4. Habits and Lifestyle
- **Tobacco or Alcohol Use**: Consumption frequency
- **Physical Activity**: Type and frequency of exercise
- **Sleep and Stress**: Quality of rest and stress levels
- **Diet**: General eating habits and diet description

### 5. Vital Signs (if available)
- **Body Temperature**: Recent temperature readings
- **Blood Pressure**: Systolic and diastolic values
- **Heart Rate**: Beats per minute
- **Oxygen Saturation (SpO₂)**: (if provided)
- **Other Data**: Any additional vital sign information

### 6. Attached Documents and Tests
- **Documents / Tests**: Recent medical tests, analyses, or reports

### 7. Chatbot (AI) Automated Analysis
- **Key Symptoms Identified**: AI summary of main symptoms
- **Suggested Specialty Areas**: Recommended medical specialties
- **Estimated Urgency Level**: Preliminary urgency assessment
- **Preliminary Recommendations**: Suggested next steps

### 8. Consent
- **Consent Text**: Standard medical consent statement
- **Patient Authorization**: Patient's consent confirmation
- **Date**: Date and time of consultation

## Data Extraction

### How Information is Mapped

The system extracts information from the conversation based on question order:

```typescript
Question 0  → Main Complaint
Question 1  → Symptom Duration
Question 2  → Progression
Question 3  → Discomfort Description
Question 4  → Related Symptoms
Question 5  → Full Name
Question 6  → Age
Question 7  → Biological Sex
Question 8  → City/Country
Question 9  → Weight & Height
Question 10 → Chronic Illnesses
Question 11 → Current Medications
Question 12 → Previous Surgeries
Question 13 → Allergies
Question 14 → Tobacco/Alcohol
Question 15 → Physical Activity
Question 16 → Sleep & Stress
Question 17 → Diet
Question 18 → (Vital signs intro - skipped)
Question 19 → Temperature
Question 20 → Blood Pressure
Question 21 → Heart Rate
Question 22 → Medical Documents
Question 23 → Authorization
```

### BMI Calculation

The system automatically calculates BMI from the weight and height response:
- Extracts numeric values from user's text response
- Detects if height is in cm (>3) and converts to meters
- Calculates BMI using formula: weight (kg) / height² (m²)
- Displays result rounded to 1 decimal place

**Example:**
- User input: "75 kg and 1.75 m"
- Extracted: weight=75, height=1.75
- BMI = 75 / (1.75 × 1.75) = 24.5

## PDF Styling

### Typography
- **Title**: 18pt, bold, dark blue (#003366)
- **Subtitle**: 9pt, italic, gray
- **Section Titles**: 13pt, bold, blue (#0066CC)
- **Field Labels**: 10pt, bold, black
- **Field Values**: 10pt, normal, dark gray

### Layout
- **Margins**: 20px on all sides
- **Page Size**: Standard A4 (210mm × 297mm)
- **Automatic Pagination**: Adds new pages as needed
- **Page Footers**: "Page X of Y - Generated by Medical Pre-Consultation AI"

### Special Formatting
- **Consent Section**: Light blue background box
- **Text Wrapping**: Automatic line wrapping for long text
- **Section Spacing**: 5px between sections
- **Field Spacing**: 6px between fields

## File Naming

PDFs are saved with the format:
```
medical-record-[PatientName]-[Timestamp].pdf
```

**Example:**
```
medical-record-John-Smith-1699722348901.pdf
```

## Implementation Files

### Modified Files

1. **`/lib/pdf-generator.ts`**
   - Added `extractPatientData()` function to parse messages
   - Added `calculateBMI()` function for BMI calculation
   - Created `generatePDFFromMessages()` main generation function
   - Kept legacy `generatePDF()` for backward compatibility

2. **`/app/components/FloatingChat.tsx`**
   - Updated to call `generatePDFFromMessages()` with messages array
   - Removed dependency on old report format

3. **`/app/consultation/[id]/page.tsx`**
   - Updated to call `generatePDFFromMessages()` with messages array
   - Consistent with FloatingChat implementation

## Usage

### For Users
1. Complete the 27-question medical interview
2. Click "Generate & Download Report" button
3. PDF is automatically created and downloaded
4. File includes all collected information in structured format

### For Developers

```typescript
import { generatePDFFromMessages } from '@/lib/pdf-generator';
import type { Message } from '@/lib/consultations';

// Generate PDF from consultation messages
const messages: Message[] = consultation.messages;
const consultationDate: Date = consultation.createdAt;

generatePDFFromMessages(messages, consultationDate);
```

## Benefits

1. **Comprehensive**: Captures all 8 sections of medical information
2. **Structured**: Follows professional medical record format
3. **Automatic**: No manual data entry or formatting required
4. **Consistent**: Same format for every report
5. **Professional**: Suitable for healthcare professional review
6. **Complete**: Includes all collected information with proper labeling

## Future Enhancements

Possible improvements:
- Add patient signature field (digital signature)
- Include doctor notes section for later completion
- Add customizable logo/branding
- Support for multiple languages
- Attach supporting documents (lab results, images)
- Export to different formats (DOCX, HTML)
- Integrate with EHR systems

## Testing

To verify the PDF generation:

1. Complete a full consultation with all 27 questions answered
2. Generate the PDF report
3. Verify all sections are present
4. Check that BMI is calculated correctly
5. Confirm formatting matches template
6. Verify patient name appears in filename
7. Check consent section is properly formatted

## Notes

- If a question is not answered, field shows "Not provided"
- BMI calculation requires recognizable weight/height format
- All dates are formatted as: Month Day, Year, Hour:Minute AM/PM
- PDF uses standard jsPDF library
- Reports are generated client-side for privacy

## Date
Implementation completed: November 11, 2025

